<div class="w3-container" style="max-width: 700px; margin: 2rem auto;">

    <div class="w3-container w3-center w3-margin">
        <h2>{{mensaje}}</h2>
        <p>La respuesta correcta a la pregunta
            "{{pregunta}}" de la categoria {{categoria}} era: {{respuestaCorrecta}}</p>
        <div class="w3-panel w3-pale-green w3-padding">
            <h3>Â¡Resumen de Puntos!</h3>
            <p>Puntaje de la partida: <strong>{{puntajeFinal}}</strong></p>
            <p>Puntos ganados: <strong>+{{puntosGanados}}</strong></p>
            {{#usuario}}
                <p>Puntos acumulados: <strong>{{puntos_acumulados}}</strong></p>
                <p>Tu nivel actual: <strong>{{nivel}}</strong></p>
            {{/usuario}}
        </div>
        <a href="/game/jugarPartida" class="w3-button w3-green w3-margin-top">Jugar de Nuevo</a>
        <a href="/user/lobby" class="w3-button w3-blue w3-margin-top">Volver al Lobby</a>
    </div>

    <div class="w3-container w3-center">
        <h4>Historial de la Partida</h4>
        <p class="w3-small w3-text-grey">Si crees que alguna pregunta es incorrecta, podes reportarla.</p>
    </div>

    <table class="w3-table-all w3-card">
        <thead>
        <tr class="w3-light-grey">
            <th>Categoria</th>
            <th>Pregunta</th>
            <th>Accion</th>
        </tr>
        </thead>

        <tbody>
        {{#historial_partida}}
            <tr>
                <td>{{categoria}}</td>
                <td>{{pregunta}}</td>
                <td>
                    <button onclick="toggleReportForm('{{pregunta_id}}')" class="w3-button w3-red w3-tiny w3-round">Reportar</button>
                </td>
            </tr>
            <tr id="report-form-{{pregunta_id}}" style="display:none;">
                <td colspan="3" class="w3-light-grey">
                    <form action="/game/reportarPregunta" method="POST" class="w3-container w3-padding">
                        <input type="hidden" name="pregunta_id" value="{{pregunta_id}}">
                        <label for="motivo-{{pregunta_id}}"><b>Motivo del reporte:</b></label>
                        <textarea name="motivo" id="motivo-{{pregunta_id}}" class="w3-input w3-border" style="margin: 8px 0;" required></textarea>
                        <button type="submit" class="w3-button w3-red">Enviar Reporte</button>
                    </form>
                </td>
            </tr>
        {{/historial_partida}}
        </tbody>
    </table>

</div>

<script>
    function toggleReportForm(preguntaId) {
        var formRow = document.getElementById('report-form-' + preguntaId);
        if (formRow.style.display === 'none') {
            formRow.style.display = 'table-row';
        } else {
            formRow.style.display = 'none';
        }
    }
</script>